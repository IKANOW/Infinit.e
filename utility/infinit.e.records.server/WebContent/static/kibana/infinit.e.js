/*! kibana - v3.1.2 - 2015-02-04
 * Copyright (c) 2015 Rashid Khan; Licensed Apache License */

function installKibanaJsApiToParent(){kibanaJsApi.installToParent()}function QueryTerm(a,b){this.query=a,this.alias="",this.id=b,this.pin=!1,this.type="lucene",this.enable=!0,this.parent=b}function TimeTerm(a,b){this.type="time",this.field="@timestamp",this.from=a,this.to=b,this.mandate="must",this.active=!0,this.alias=""}function FilterString(a,b){this.id=b,this.type="querystring",this.query=a,this.mandate="must",this.active=!0,this.alias=""}var infiniteJsConnector=infiniteJsConnector||{_flashMovie:null,_jsConnectorParent:null,_mode:"stashed",init:function(){null==this._flashMovie&&document.getElementById&&(this._flashMovie=parent.document.getElementById("Index"))},getFlashMovie:function(){return this._flashMovie},getJsConnectorParent:function(){return this._jsConnectorParent=parent.infiniteJsConnectorParent,parent.infiniteJsConnectorParent},getMode:function(){return this._mode},setMode:function(a){return this._mode=a,this._mode},getCIds:function(a){return this.getCommunityIds(a)},getParentId:function(){for(var a=window;a!==a.parent;)a=a.parent;a=a.document;var b=a.getElementsByTagName("iframe");return b[0].getAttribute("id")},getCommunityIds:function(a){var b=this;try{var c=b.getFlashMovie().getCommunityIds(a)}catch(d){}return c},getDatasetFlags:function(){var a=this;try{var b=a.getFlashMovie().getDatasetFlags()}catch(c){}return b},getExtraUrlParams:function(a){try{var b={cids:this.getCIds(a),mode:this.getMode()},c=this.getDatasetFlags();if(c&&c.length>0){var d=c.split("&");for(var e in d){var f=d[e].split("=",2);2==f.length&&f[0].length>0&&(b[f[0]]=f[1])}}if(a.length>512){var g=a.indexOf("/proxy/");if(g>0){var h=a.substring(g+7),i=h.indexOf("/");i>0&&(h=h.substring(0,i),b.indexes=h,a=a.replace(h,"$indexes"),b.url=a)}}return b}catch(j){return console.log("getExtraUrlParams: "+j.message),null}},setLive:function(a){1==a?(window.location="/infinit.e.records/static/kibana/index.html#/dashboard/file/Kibana_LiveTemplate.json",infiniteJsConnector.setMode("live")):0==a&&(window.location="/infinit.e.records/static/kibana/index.html#/dashboard/file/Kibana_StashedTemplate.json",infiniteJsConnector.setMode("stashed"))},onWidgetLoadWithParameters:function(a){var b=a,c=b.split("&");if(c.length>0)for(var d in c){var e=c[d].split("=");if(e.length>1){var f=e[0];("?cids"==f||"cids"==f)&&infiniteJsConnector.setCIds(e[1]),("?mode"==f||"mode"==f)&&infiniteJsConnector.setMode(e[1])}}}};window.onload=function(){try{window.location.search.length>0&&infiniteJsConnector.onWidgetLoadWithParameters(window.location.search),infiniteJsConnector.init()}catch(a){}},mirrorQuery=function(a){for(var b=JSON.parse(a),c=[],d=[],e=0;e<b.qt.length;e++){var f=b.qt[e];null!=f&&(null!=f.etext?c.push(new QueryTerm(f.etext,c.length)):null!=f.ftext?c.push(new QueryTerm(f.ftext,c.length)):null!=f.entity?c.push(new QueryTerm(f.entity.split("/")[0],c.length)):null!=f.time&&null!=f.time.min&&null!=f.time.max&&d.push(new TimeTerm(f.time.min,f.time.max)))}null!=c&&kibanaJsApi.setQueryList(c,!1,!1),null!=d&&kibanaJsApi.setFilters(d,!1,!1)},refreshKibana=function(){kibanaJsApi.refreshDashboard()},ikanowObjectsToKibana=function(a){if(null!=a){try{var b=JSON.parse(a.toString())}catch(c){try{var b=JSON.parse(a.toString().replace(/[\b]/g,"\\b").replace(/[\f]/g,"\\f").replace(/[\n]/g,"\\n").replace(/[\r]/g,"\\r").replace(/[\t]/g,"\\t"))}catch(d){alert("Unable to Process Data:  "+d)}}if(null!=b){var e="AND",f=!1,g=!1,h=!1,i="",j=[],k=[];if(null!=b.termsOverride&&(e=b.termsOverride),null!=b.decomposeInfiniteQuery&&(f=b.decomposeInfiniteQuery),null!=b.appendToExistingKibanaQueries&&(g=b.appendToExistingKibanaQueries),null!=h&&(h=b.applyToFilter),null!=b.entities&&null!=b.entities.source)for(var l=0;l<b.entities.source.length;l++){var m=b.entities.source[l];if(null!=m){var n=null;null!=m.actual_name?n=m.actual_name:null!=m.etext?n=m.etext:null!=m.ftext?n=m.ftext:null!=m.entity?n=m.entity.substring(0,m.entity.lastIndexOf("/")):null!=m.time&&null!=m.time.min&&null!=m.time.max&&k.push(new TimeTerm(m.time.min,m.time.max)),null!=n&&(1==f?j.push(1==h?new FilterString('"'+n+'"',j.length):new QueryTerm('"'+n+'"',j.length)):""==i?i='"'+n+'"':i+=" "+e+' "'+n+'"')}}if(null!=b.associations&&null!=b.associations.source)for(var l=0;l<b.associations.source.length;l++){var o=b.associations.source[l],p=null,q=null;if(null!=o.entity1&&(p=o.entity1),null!=o.entity2&&(q=o.entity2),null==p&&null!=o.entity1_index&&(p=o.entity1_index.substring(0,o.entity1_index.lastIndexOf("/"))),null==q&&null!=o.entity2_index&&(q=o.entity2_index.substring(0,o.entity2_index.lastIndexOf("/"))),null!=o&&(null!=p||null!=q)){var r="";null!=p&&null!=q?r='("'+p+'" AND "'+q+'")':null!=p?r='"'+p+"'":null!=q&&(r='"'+q+'"'),1==f?j.push(1==h?new FilterString(r,j.length):new QueryTerm(r,j.length)):""==i?i=r:i+=" "+e+" "+r}}null!=i&&""!=i&&j.push(1==h?new FilterString(i,j.length):new QueryTerm(i,j.length)),null!=j&&j.length>0&&(1==h?kibanaJsApi.setFilters(j,g,g):kibanaJsApi.setQueryList(j,g,g)),null!=k&&k.length>0&&(1==h?kibanaJsApi.setFilters(k,!0,!0):kibanaJsApi.setFilters(k,g,g))}}};